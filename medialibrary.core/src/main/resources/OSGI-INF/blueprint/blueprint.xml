<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0">

    <!-- OSGi Configuration Admin Service -->
    <reference id="configAdminService"
               interface="org.osgi.service.cm.ConfigurationAdmin"/>

    <!-- OSGi Event Admin Service -->
    <reference id="eventAdminService"
               interface="org.osgi.service.event.EventAdmin"/>

    <!-- Chii2 Media Library Persistence Service -->
    <reference id="persistenceManager"
               interface="org.chii2.medialibrary.api.persistence.PersistenceService"/>

    <!-- Chii2 Media Library Movie Factory -->
    <reference id="movieFactoryManager"
               interface="org.chii2.medialibrary.api.persistence.factory.MovieFactory"/>

    <!-- Chii2 Media Library File Service -->
    <reference id="fileManager"
               interface="org.chii2.medialibrary.api.file.FileService"/>

    <!-- Chii2 Media Library Movie Information Provider Service -->
    <reference-list id="movieProviderManager"
                    interface="org.chii2.medialibrary.api.provider.MovieInfoProviderService"/>

    <!-- Chii2 Media Library Image Information Provider Service -->
    <reference-list id="imageProviderManager"
                    interface="org.chii2.medialibrary.api.provider.ImageInfoProviderService"/>

    <!-- Chii2 Media Library Core Bean -->
    <bean id="medialibraryService" class="org.chii2.medialibrary.MediaLibraryServiceImpl"
          init-method="init"
          destroy-method="destroy">
        <property name="persistenceService" ref="persistenceManager"/>
        <property name="fileService" ref="fileManager"/>
    </bean>

    <!-- Chii2 Media Library Movie Event Handler Bean -->
    <bean id="movieHandler" class="org.chii2.medialibrary.event.MovieHandler"
          init-method="init"
          destroy-method="destroy">
        <property name="configAdmin" ref="configAdminService"/>
        <property name="eventAdmin" ref="eventAdminService"/>
        <property name="persistenceService" ref="persistenceManager"/>
        <property name="movieFactory" ref="movieFactoryManager"/>
        <property name="providerServices" ref="movieProviderManager"/>
    </bean>

    <!-- Chii2 Media Library Image Event Handler Bean -->
    <bean id="imageHandler" class="org.chii2.medialibrary.event.ImageHandler"
          init-method="init"
          destroy-method="destroy">
        <property name="configAdmin" ref="configAdminService"/>
        <property name="eventAdmin" ref="eventAdminService"/>
        <property name="persistenceService" ref="persistenceManager"/>
        <property name="providerServices" ref="imageProviderManager"/>
    </bean>

    <!-- Chii2 Media Library Core Service -->
    <service ref="medialibraryService" interface="org.chii2.medialibrary.api.core.MediaLibraryService">
    </service>

    <!-- Chii2 Media Library Movie Event Handler Service -->
    <service ref="movieHandler" interface="org.osgi.service.event.EventHandler">
        <service-properties>
            <!-- Register Event Topics -->
            <entry key="event.topics">
                <list>
                    <value>org/chii2/medialibrary/file/movie/SCAN</value>
                    <value>org/chii2/medialibrary/provider/movie/INFO_PROVIDED</value>
                    <value>org/chii2/medialibrary/provider/movie/INFO_FAILED</value>
                    <value>org/chii2/medialibrary/provider/movie/IMAGE_PROVIDED</value>
                </list>
            </entry>
        </service-properties>
    </service>

    <!-- Chii2 Media Library Image Event Handler Service -->
    <service ref="imageHandler" interface="org.osgi.service.event.EventHandler">
        <service-properties>
            <!-- Register Event Topics -->
            <entry key="event.topics">
                <list>
                    <value>org/chii2/medialibrary/file/image/SCAN</value>
                    <value>org/chii2/medialibrary/provider/image/INFO_PROVIDED</value>
                    <value>org/chii2/medialibrary/provider/image/INFO_FAILED</value>
                </list>
            </entry>
        </service-properties>
    </service>

</blueprint>